# ğŸ—ï¸ Architecture du Cache - Explication Visuelle

## ğŸ“Š Vue d'Ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SITUATION ACTUELLE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/app/catalogue/page.tsx     â”‚     â”‚  src/utils/catalogueCache.tsâ”‚
â”‚                                 â”‚     â”‚                             â”‚
â”‚  âœ… UTILISÃ‰                     â”‚     â”‚  âŒ NON UTILISÃ‰             â”‚
â”‚  - Cache localStorage inline    â”‚     â”‚  - Classe ClientCache<T>    â”‚
â”‚  - TTL 5 minutes                â”‚     â”‚  - SystÃ¨me rÃ©utilisable     â”‚
â”‚  - Stale-while-revalidate       â”‚     â”‚  - Features avancÃ©es        â”‚
â”‚  - Retry logic                  â”‚     â”‚  - CrÃ©Ã© pour usage futur    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                          â”‚
         â”‚                                          â”‚
         â–¼                                          â–¼
  FONCTIONNE MAINTENANT                    PRÃŠT POUR SCALABILITÃ‰
```

---

## ğŸ” DÃ©tail : `catalogue/page.tsx` (ACTUEL)

### Architecture Interne

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              catalogue/page.tsx (Composant Client)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  useEffect(() => {                                              â”‚
â”‚    fetchCatalogData()                                           â”‚
â”‚  })                                                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  fetchCatalogData() - Fonction principale              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. VÃ©rifier localStorage                               â”‚   â”‚
â”‚  â”‚     â”œâ”€ Cache valide ? â”€â”€> OUI â”€â”€> Afficher + Refresh   â”‚   â”‚
â”‚  â”‚     â””â”€ Cache invalide ? â”€> NON â”€â”€> Aller Ã  Ã©tape 2     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  2. Fetch API (/api/catalogue/featured?limit=20)        â”‚   â”‚
â”‚  â”‚     â”œâ”€ SuccÃ¨s ? â”€â”€> Mettre en cache + Afficher         â”‚   â”‚
â”‚  â”‚     â””â”€ Erreur ? â”€â”€> Retry (3x) ou Fallback             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  3. Mise en cache (localStorage)                        â”‚   â”‚
â”‚  â”‚     â””â”€ Stocker { data, timestamp }                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  fetchInBackground() - Refresh silencieux              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  - Fetche depuis l'API en arriÃ¨re-plan                  â”‚   â”‚
â”‚  â”‚  - Met Ã  jour le cache sans bloquer l'UI                â”‚   â”‚
â”‚  â”‚  - AppelÃ© quand cache hit (stale-while-revalidate)      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flux de DonnÃ©es

```
Utilisateur charge /catalogue
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. VÃ©rifier Cache  â”‚
â”‚  (localStorage)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cache valide ? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                        â”‚
      OUI â”‚                                    NONâ”‚
         â”‚                                        â”‚
         â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2a. Afficher Cache  â”‚              â”‚  2b. Fetch API       â”‚
â”‚  (Instant < 50ms)    â”‚              â”‚  (500-2000ms)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                        â”‚
         â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3a. Refresh         â”‚              â”‚  3b. Stocker Cache   â”‚
â”‚  Background          â”‚              â”‚  + Afficher          â”‚
â”‚  (Non-bloquant)      â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ DÃ©tail : `catalogueCache.ts` (DISPONIBLE MAIS NON UTILISÃ‰)

### Classe ClientCache<T>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ClientCache<T> (Classe RÃ©utilisable)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  private cache: Map<string, CachedData<T>>                  â”‚
â”‚  private defaultTTL: number                                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MÃ©thodes Principales                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  get(key: string): T | null                           â”‚  â”‚
â”‚  â”‚    â”œâ”€ VÃ©rifier si clÃ© existe                          â”‚  â”‚
â”‚  â”‚    â”œâ”€ VÃ©rifier expiration                             â”‚  â”‚
â”‚  â”‚    â””â”€ Retourner donnÃ©es ou null                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  set(key: string, data: T, ttl?: number): void        â”‚  â”‚
â”‚  â”‚    â”œâ”€ Calculer expiresAt = now + ttl                  â”‚  â”‚
â”‚  â”‚    â””â”€ Stocker dans Map                                â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  invalidate(key: string): void                        â”‚  â”‚
â”‚  â”‚    â””â”€ Supprimer de la Map                             â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  invalidatePattern(pattern: RegExp): void             â”‚  â”‚
â”‚  â”‚    â””â”€ Supprimer toutes clÃ©s matchant le pattern       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  clear(): void                                         â”‚  â”‚
â”‚  â”‚    â””â”€ Vider toute la Map                              â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  cleanup(): void                                       â”‚  â”‚
â”‚  â”‚    â””â”€ Supprimer les entrÃ©es expirÃ©es                  â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MÃ©thodes Utilitaires                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  has(key: string): boolean                            â”‚  â”‚
â”‚  â”‚  size(): number                                        â”‚  â”‚
â”‚  â”‚  getAge(key: string): number | null                   â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Structure des DonnÃ©es

```
CachedData<T> {
  data: T                 // Les donnÃ©es rÃ©elles
  timestamp: number       // Timestamp de crÃ©ation
  expiresAt: number       // Timestamp d'expiration
}

Exemple dans la Map :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Key: "catalogue-featured-items"                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Value: {                                              â”‚
â”‚    data: [CatalogItem, CatalogItem, ...],             â”‚
â”‚    timestamp: 1704729600000,                           â”‚
â”‚    expiresAt: 1704729900000  (timestamp + 5 min)      â”‚
â”‚  }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Comparaison : Inline vs Class

### Approche Inline (Actuelle)

```typescript
// âŒ Code dupliquÃ© dans chaque composant

// Composant 1: Catalogue
useEffect(() => {
  const cached = localStorage.getItem("catalogue-items");
  if (cached) {
    const { data, timestamp } = JSON.parse(cached);
    if (Date.now() - timestamp < TTL) {
      setData(data);
      return;
    }
  }
  fetchData();
}, []);

// Composant 2: Users (mÃªme logique rÃ©pÃ©tÃ©e)
useEffect(() => {
  const cached = localStorage.getItem("users-list");
  if (cached) {
    const { data, timestamp } = JSON.parse(cached);
    if (Date.now() - timestamp < TTL) {
      setUsers(data);
      return;
    }
  }
  fetchUsers();
}, []);

// Composant 3: Products (encore rÃ©pÃ©tÃ©)
useEffect(() => {
  const cached = localStorage.getItem("products-list");
  // ... mÃªme code rÃ©pÃ©tÃ© ...
}, []);
```

**ProblÃ¨mes** :

- âŒ Code dupliquÃ© 10x
- âŒ Difficile Ã  maintenir
- âŒ Pas de tests unitaires
- âŒ Pas de mÃ©triques

---

### Approche Class (Disponible)

```typescript
// âœ… Code rÃ©utilisable

// CrÃ©er les caches une fois
const catalogueCache = new ClientCache<CatalogItem[]>(5 * 60 * 1000);
const userCache = new ClientCache<User[]>(15 * 60 * 1000);
const productCache = new ClientCache<Product[]>(10 * 60 * 1000);

// Composant 1: Catalogue
useEffect(() => {
  const cached = catalogueCache.get("items");
  if (cached) {
    setData(cached);
    return;
  }
  fetchData().then((data) => catalogueCache.set("items", data));
}, []);

// Composant 2: Users
useEffect(() => {
  const cached = userCache.get("list");
  if (cached) {
    setUsers(cached);
    return;
  }
  fetchUsers().then((users) => userCache.set("list", users));
}, []);

// Composant 3: Products
useEffect(() => {
  const cached = productCache.get("list");
  if (cached) {
    setProducts(cached);
    return;
  }
  fetchProducts().then((products) => productCache.set("list", products));
}, []);
```

**Avantages** :

- âœ… Pas de duplication
- âœ… 1 seul fichier Ã  maintenir
- âœ… Tests unitaires faciles
- âœ… MÃ©triques automatiques

---

## ğŸ¯ Pourquoi 2 Versions Existent ?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 RAISON DE L'EXISTENCE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Version Inline (catalogue/page.tsx)                     â”‚
â”‚     â””â”€ âœ… Solution IMMÃ‰DIATE pour corriger le bug           â”‚
â”‚     â””â”€ âœ… FONCTIONNE maintenant                             â”‚
â”‚     â””â”€ âš ï¸  Pas scalable                                     â”‚
â”‚                                                              â”‚
â”‚  2. Version Class (catalogueCache.ts)                       â”‚
â”‚     â””â”€ âœ… Solution FUTURE pour scalabilitÃ©                  â”‚
â”‚     â””â”€ âœ… PRÃŠTE Ã  Ãªtre utilisÃ©e                             â”‚
â”‚     â””â”€ âš ï¸  NÃ©cessite refactoring                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ScÃ©nario d'Usage Futur

### Ã‰tape 1 : CrÃ©er les Caches PartagÃ©s

```typescript
// src/lib/caches.ts
import { ClientCache } from "@/utils/catalogueCache";

export const catalogueCache = new ClientCache<CatalogItem[]>(5 * 60 * 1000);
export const userCache = new ClientCache<User>(15 * 60 * 1000);
export const settingsCache = new ClientCache<Settings>(30 * 60 * 1000);
```

### Ã‰tape 2 : Utiliser Partout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              APPLICATION (10+ Composants)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Catalogue   â”‚  â”‚  UserProfile â”‚  â”‚  Settings    â”‚     â”‚
â”‚  â”‚  Page        â”‚  â”‚  Page        â”‚  â”‚  Page        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                    â”‚                   â”‚                     â”‚
â”‚                    â–¼                   â–¼                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚       src/lib/caches.ts             â”‚             â”‚
â”‚         â”‚  (Instances partagÃ©es)              â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚  src/utils/catalogueCache.ts        â”‚             â”‚
â”‚         â”‚  (Classe ClientCache)               â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DÃ©cision : Quand Migrer ?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ARBRE DE DÃ‰CISION                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                Combien de composants utilisent du cache ?
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚               â”‚
               1-2             3-5             6+
                â”‚               â”‚               â”‚
                â–¼               â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ GARDER      â”‚  â”‚ ENVISAGER   â”‚  â”‚ MIGRER      â”‚
         â”‚ Inline      â”‚  â”‚ Migration   â”‚  â”‚ Vers Class  â”‚
         â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
         â”‚ âœ… Simple   â”‚  â”‚ âš ï¸ Ã‰valuer  â”‚  â”‚ âœ… NÃ©cessaireâ”‚
         â”‚ âœ… Fonctionneâ”‚ â”‚   coÃ»t/     â”‚  â”‚ âœ… Scalable  â”‚
         â”‚             â”‚  â”‚   bÃ©nÃ©fice  â”‚  â”‚ âœ… Maintenableâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ RÃ©sumÃ© ExÃ©cutif

### Situation Actuelle

| Fichier              | Status     | UtilitÃ©                  |
| -------------------- | ---------- | ------------------------ |
| `catalogue/page.tsx` | âœ… ACTIF   | Cache inline fonctionnel |
| `catalogueCache.ts`  | â³ STANDBY | PrÃªt pour usage futur    |

### Relation

```
catalogue/page.tsx  âŒâ”€â”€â”€â”€â”€â”€â•³â”€â”€â”€â”€â”€â”€âŒ  catalogueCache.ts
    (N'utilise PAS)              (Non utilisÃ©)

MAIS :

catalogue/page.tsx  âœ…â”€â”€â”€â”€â”€â”€â†’â”€â”€â”€â”€â”€â”€âœ…  localStorage
    (Utilise directement)           (Cache inline)
```

### Recommandation

**MAINTENANT** : âœ… Garder inline (fonctionne parfaitement)

**PLUS TARD** (si 3+ composants utilisent cache) :
âœ… Migrer vers `catalogueCache.ts`

---

## ğŸ¤” Questions FrÃ©quentes

**Q: Pourquoi catalogueCache.ts existe si non utilisÃ© ?**
A: PrÃ©paration pour la scalabilitÃ© future. Ã‰vite de refaire le travail.

**Q: Dois-je supprimer catalogueCache.ts ?**
A: âŒ NON ! Gardez-le pour usage futur.

**Q: Puis-je utiliser les deux ?**
A: âš ï¸ Non recommandÃ©. Choisissez l'un ou l'autre pour cohÃ©rence.

**Q: Quand migrer ?**
A: Quand vous ajoutez du cache dans 3+ composants.

---

**Date** : 2025-10-09
**Status** : âœ… Documentation complÃ¨te
